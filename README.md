# k8s-demo-project
In this project, firstly I created a sample Java application that prints query parameters of an endpoint. Then I created a Dockerfile for this application. The dockerfile has 2 stages. In the first stage, initially, pom.xml is copied to the working directory and dependencies are installed with maven. Since pom.xml is copied and dependencies are installed before src folder is copied, these steps may be skipped even if there are some changes in the code due to caching. Then, src folder is copied and the application is built with maven. Eventually, a jar file is created. In the second stage, the created jar file in the first stage is copied to this stage. The cmd instruction of this stage simply runs the application using the jar file.I built a docker image with this dockerfile and pushed it to a dockerhub registry. I created the required kubernetes cluster in gcp. I prepared an ansible playbook to create the cluster and repeat the required steps whenever needed (The created resources can be deleted with play-delete-all.yaml playbook.). This playbook does the followings as a summary: <br/>
* Creates a controller vm and 2 worker vms on gcp.
* Installs common prerequisites, docker, kubelet, kubeadm, and kubectl on all nodes.
* Initializes the kubernetes cluster on the controller node via kubeadm.
* Joins worker nodes to the kubernetes cluster.
* Installs Calico CNI plugin (required for pod networking), metrics server addon (required for hpa) and Nginx Ingress Controller (via helm).<br/>

After creating the cluster, I created the required manifests for the application. The created manifests are used for creating deployment, hpa, service and ingress resources. The deployment object is used for creating 2 pods which runs the application. The hpa object is used for horizontally scaling the application by creating or deleting the pods. There can be a minimum of 2 pods and a maximum of 5 pods. The target average cpu utilization is set to 50 percent. The service object is a ClusterIP type service which is used for routing the incoming request to one of the pods of the application. The created ingress object is used to expose the application. When a request comes to the nginx-ingress load balancer, the traffic is routed to the service of the application. I created a kustomization file and specified the related files in the resources section of file. I deployed all of the objects with the `kubectl apply -k .` command. Then, I created a locustfile to generate some load on the application and test the hpa.<br/>
You can test the application with the following URL: http://34.65.22.130/print-param?param=test (Note that it may not work since I may need to delete the resources on gcp after some time due to cost.)
## Screenshots
* <img width="1011" alt="Screenshot 2024-04-28 at 14 34 10" src="https://github.com/omersafakbebek/k8s-demo-project/assets/75090441/f50bf80c-be47-46f2-8692-a8e2de15f393">
* <img width="977" alt="Screenshot 2024-04-28 at 14 19 58" src="https://github.com/omersafakbebek/k8s-demo-project/assets/75090441/fa3783d7-0f87-486b-bf02-57452f27ad84"> <br/>
* <img width="941" alt="Screenshot 2024-04-28 at 14 29 11" src="https://github.com/omersafakbebek/k8s-demo-project/assets/75090441/fbbd09ec-04c5-4da0-92c5-b85912d363e4"> <br/>
* <img width="1153" alt="Screenshot 2024-04-28 at 14 32 59" src="https://github.com/omersafakbebek/k8s-demo-project/assets/75090441/a50740fb-c42b-403e-bc4b-211b9654e192">
* <img width="1011" alt="Screenshot 2024-04-28 at 14 40 11" src="https://github.com/omersafakbebek/k8s-demo-project/assets/75090441/0788ea1f-286c-4892-84fa-8371c5898f5a">
